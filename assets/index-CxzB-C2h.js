(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function t(o){if(o.ep)return;o.ep=!0;const c=r(o);fetch(o.href,c)}})();function y(e,n,r,t){e.images[t]&&(n.classList.remove("hidden"),document.body.classList.add("modal-open"),r.src=e.images[t].urls.regular,r.alt=e.images[t].alt_description||"",e.currentIndex=t)}function h(e,n){e.classList.add("hidden"),document.body.classList.remove("modal-open"),n.src=""}function g(e,n,r){e.currentIndex=(e.currentIndex+1)%e.images.length,y(e,n,r,e.currentIndex)}function p(e,n,r){e.currentIndex=(e.currentIndex-1+e.images.length)%e.images.length,y(e,n,r,e.currentIndex)}function S(e){const n=document.createElement("div");n.className="modal hidden",n.innerHTML=`
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <button class="modal-close">&times;</button>
        <button class="modal-prev">&#10094;</button>
        <img class="modal-image" src="" alt="">
        <button class="modal-next">&#10095;</button>
      </div>
    `,document.body.appendChild(n);const r=n.querySelector(".modal-image"),t=n.querySelector(".modal-close"),o=n.querySelector(".modal-overlay"),c=n.querySelector(".modal-prev"),i=n.querySelector(".modal-next");document.addEventListener("keydown",s=>{n.classList.contains("hidden")||(s.key==="Escape"&&h(n,r),s.key==="ArrowRight"&&g(e,n,r),s.key==="ArrowLeft"&&p(e,n,r))}),t.addEventListener("click",()=>h(n,r)),o.addEventListener("click",()=>h(n,r)),i.addEventListener("click",()=>g(e,n,r)),c.addEventListener("click",()=>p(e,n,r));let d=0,f=0;n.addEventListener("touchstart",s=>{d=s.changedTouches[0].screenX}),n.addEventListener("touchend",s=>{f=s.changedTouches[0].screenX,I()});function I(){f<d-50&&g(e,n,r),f>d+50&&p(e,n,r)}return{setImages(s){if(!Array.isArray(s))throw new Error("setImages expects array");e.images=s},open(s){y(e,n,r,s)}}}const b="https://api.unsplash.com/search/photos",P="4BhH6aovDpv84FFGv_p1vREzcXmcZQf3zRkCy2s9Ovs",x=/^[\wа-яА-ЯёЁ0-9 !$&*\-=^`|~#%' +/?_{}]{2,30}$/i,C="nature",q=30;async function A(e,n=1){const r=await fetch(`${b}?query=${encodeURIComponent(e)}&page=${n}&per_page=${q}&orientation=squarish`,{headers:{Authorization:`Client-ID ${P}`}});if(!r.ok)throw new Error(`Error: ${r.status}`);const t=await r.json();if(!(t!=null&&t.results))throw new Error("Incorrect response from API");return t.results}function N(e,n){const r=document.createElement("p");r.className="error-message",r.textContent=e,n.appendChild(r)}function _(e,n,r){if(!e.length&&n.currentPage===1){r.textContent="Nothing found for your request.";return}const t=document.createDocumentFragment();e.forEach((o,c)=>{const i=document.createElement("div");i.className="card",i.dataset.index=n.images.length-e.length+c;const d=document.createElement("img");d.src=o.urls.small,d.alt=o.alt_description||"Image",i.appendChild(d),t.appendChild(i)}),r.appendChild(t)}async function O(e,n,r,t,o,c,i){e.preventDefault();const d=r.value.trim();if(!x.test(d)){t.textContent="Please enter between 2 and 30 valid characters.",t.classList.add("visible");return}t.textContent="",t.classList.remove("visible"),n.currentQuery=d,n.currentPage=1,await v(n,o,c,i)}async function v(e,n,r,t){e.isLoading=!0,r.classList.remove("hidden");try{const o=await A(e.currentQuery,e.currentPage);e.currentPage===1&&(n.innerHTML="",e.images=[]),e.images=[...e.images,...o],_(o,e,n),t.setImages(e.images)}catch(o){N(`Loading error: ${o.message}`,n)}finally{r.classList.add("hidden"),e.isLoading=!1}}function R(e,n,r,t){const o=window.innerHeight+window.scrollY,c=document.body.offsetHeight-100;o>=c&&!e.isLoading&&(e.currentPage++,v(e,n,r,t))}function $(e,n){const r=e.target.closest(".card");if(!r)return;const t=parseInt(r.dataset.index);isNaN(t)||n.open(t)}const L=document.querySelector(".search-form"),E=document.querySelector(".js-search-input"),w=document.querySelector(".js-error-message"),a=document.querySelector(".js-gallery"),u=document.querySelector(".js-loader");if(!L||!E||!w||!a||!u)throw new Error("Missing essential DOM elements");const m={currentQuery:C,currentPage:1,isLoading:!1,images:[],currentIndex:0},l=S(m);function T(){v(m,a,u,l)}function k(){L.addEventListener("submit",e=>O(e,m,E,w,a,u,l)),window.addEventListener("scroll",()=>R(m,a,u,l)),a.addEventListener("click",e=>$(e,l))}k();T();
